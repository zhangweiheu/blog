title: 为什么不使用suspend和stop方法
date: 2015-11-01 23:37:16
categories: [Java基础知识]
tags: [Java,多线程]
comments: true
toc: true
---

### JDK1.0定义了stop和suspend方法：

stop用来直接终止线程,suspend会阻塞线程直到另一个线程调用resume.
stop和suspend都有一些共同的点：都试图专横的控制一个给定了的线程的行为.

从JDK1.2开始,这两个方法都被弃用了.stop天生就不安全,而经验告诉我们呢suspend方法会经常导致死锁。

反对使用stop()，是因为它不安全。它会解除由线程获取的所有锁定，当在一个线程对象上调用stop()方法时，这个线程对象所运行的线程就会立即停止，假如一个线程正在执行：synchronized void { x = 3; y = 4;}　由于方法是同步的，多个线程访问时总能保证x,y被同时赋值，而如果一个线程正在执行到x = 3;时，被调用了 stop()方法，即使在同步块中，它也干脆地stop了，这样就产生了不完整的残废数据。而多线程编程中最最基础的条件要保证数据的完整性，所以请忘记线程的stop方法，以后我们再也不要说“停止线程”了。而且如果对象处于一种不连贯状态，那么其他线程能在那种状态下检查和修改它们。结果 很难检查出真正的问题所在。

suspend()方法容易发生死锁。调用suspend()的时候，目标线程会停下来，但却仍然持有在这之前获得的锁定。此 时，其他任何线程都不能访问锁定的资源，除非被"挂起"的线程恢复运行。对任何线程来说，如果它们想恢复目标线程，同时又试图使用任何一个锁定的资源，就 会造成死锁。所以不应该使用suspend()，而应在自己的Thread类中置入一个标志，指出线程应该活动还是挂起。若标志指出线程应该挂起，便用 wait()命其进入等待状态。若标志指出线程应当恢复，则用一个notify()重新启动线程。
在程序中该怎么样使用线程呢？建议如下:
（1)最好不要使用Lock/Condition也不使用synchronized关键字。在很多情况下你可以使用java.util.concurrent包中的一种机制，它会为你处理所有的加锁。例如阻塞同步队列。
（2）如果synchronized关键字在程序中可以工作，那么就尽量使用它，这样可以减少代码数量和出错的几率。
（3）只有在非常需要Lock/Condition结构特性的时候才使用他们。

[原文地址](http://blog.sina.com.cn/s/blog_68564f2f0100iyfz.html)